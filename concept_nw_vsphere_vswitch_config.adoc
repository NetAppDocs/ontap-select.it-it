---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: Configurazione di ONTAP Select vSwitch e policy di bilanciamento del carico per configurazioni a due e quattro NIC. 
---
= Configurazione di ONTAP Select VMware vSphere vSwitch su ESXi
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Configurazione di ONTAP Select vSwitch e policy di bilanciamento del carico per configurazioni a due e quattro NIC.

ONTAP Select supporta l'utilizzo di configurazioni vSwitch sia standard che distribuite. Gli switch virtuali distribuiti supportano i costrutti di aggregazione dei link (LACP). L'aggregazione di link è una struttura di rete comune utilizzata per aggregare la larghezza di banda su più adattatori fisici. LACP è uno standard indipendente dal fornitore. Fornisce un protocollo aperto per gli endpoint di rete che raggruppano gruppi di porte di rete fisiche in un singolo canale logico. ONTAP Select può funzionare con gruppi di porte configurati come Link Aggregation Group (LAG). Tuttavia, NetApp consiglia di utilizzare le singole porte fisiche come semplici porte uplink (trunk) per evitare la configurazione LAG. In questi casi, le best practice per vSwitch standard e distribuiti sono identiche.

Questa sezione descrive la configurazione di vSwitch e i criteri di bilanciamento del carico da utilizzare nelle configurazioni a due NIC e a quattro NIC.

Quando si configurano i gruppi di porte per ONTAP Select, seguire queste best practice; la politica di bilanciamento del carico a livello di gruppo di porte è Route Based on Originating Virtual Port ID. VMware consiglia di impostare STP su Portfast sulle porte dello switch connesse agli host ESXi.

Tutte le configurazioni vSwitch richiedono un minimo di due schede di rete fisiche raggruppate in un unico team NIC. ONTAP Select supporta un singolo collegamento da 10 Gb per cluster a due nodi. Tuttavia, NetApp consiglia di utilizzare l'aggregazione NIC per garantire la ridondanza hardware.

Su un server vSphere, i raggruppamenti NIC sono il costrutto di aggregazione utilizzato per raggruppare più adattatori di rete fisici in un singolo canale logico, consentendo la condivisione del carico di rete tra tutte le porte membri. È importante ricordare che i team NIC possono essere creati senza il supporto dello switch fisico. I criteri di bilanciamento del carico e failover possono essere applicati direttamente a un team NIC, che non conosce la configurazione dello switch upstream. In questo caso, i criteri vengono applicati solo al traffico in uscita.


NOTE: I canali porta statici non sono supportati con ONTAP Select. I canali abilitati LACP sono supportati con vSwitch distribuiti, ma l'utilizzo di LAG LACP potrebbe comportare una distribuzione non uniforme del carico tra i membri del LAG.

Per i cluster a nodo singolo, ONTAP Deploy configura la VM ONTAP Select in modo che utilizzi un gruppo di porte per la rete esterna e lo stesso gruppo di porte o, facoltativamente, un gruppo di porte diverso per il traffico di gestione del cluster e dei nodi. Per i cluster a nodo singolo, è possibile aggiungere il numero desiderato di porte fisiche al gruppo di porte esterne come adattatori attivi.

Per i cluster a più nodi, ONTAP Deploy configura ogni macchina virtuale ONTAP Select in modo che utilizzi uno o due gruppi di porte per la rete interna e, separatamente, uno o due gruppi di porte per la rete esterna. Il traffico di gestione del cluster e dei nodi può utilizzare lo stesso gruppo di porte del traffico esterno o, facoltativamente, un gruppo di porte separato. Il traffico di gestione del cluster e dei nodi non può condividere lo stesso gruppo di porte con il traffico interno.


NOTE: ONTAP Select supporta un massimo di quattro VMNIC.



== VSwitch standard o distribuito e quattro porte fisiche per nodo

È possibile assegnare quattro gruppi di porte a ciascun nodo in un cluster multinodo. Ogni gruppo di porte ha una singola porta fisica attiva e tre porte fisiche in standby, come nella figura seguente.

*VSwitch con quattro porte fisiche per nodo*

image:DDN_08.jpg["VSwitch con quattro porte fisiche per nodo"]

L'ordine delle porte nell'elenco di standby è importante. La tabella seguente fornisce un esempio della distribuzione fisica delle porte tra i quattro gruppi di porte.

*Configurazioni minime di rete e consigliate*

[cols="5*"]
|===
| Gruppo di porte | Esterno 1 | Esterno 2 | Interno 1 | Interno 2 


| Attivo | vmnic0 | vmnic1 | vmnic2 | vmnic3 


| Standby 1 | vmnic1 | vmnic0 | vmnic3 | vmnic2 


| Standby 2 | vmnic2 | vmnic3 | vmnic0 | vmnic1 


| Standby 3 | vmnic3 | vmnic2 | vmnic1 | vmnic0 
|===
Le figure seguenti mostrano le configurazioni dei gruppi di porte di rete esterne dalla UI di vCenter (ONTAP-External e ONTAP-External2). Si noti che gli adattatori attivi provengono da schede di rete diverse. In questa configurazione, vmnic 4 e vmnic 5 sono porte doppie sulla stessa scheda di rete fisica, mentre vmnic 6 e vminc 7 sono porte doppie su una scheda di rete separata (le schede vnmic da 0 a 3 non vengono utilizzate in questo esempio). L'ordine delle schede di standby fornisce un failover gerarchico, con le porte della rete interna posizionate per ultime. L'ordine delle porte interne nell'elenco di standby viene analogamente scambiato tra i due gruppi di porte esterne.

*Parte 1: Configurazioni del gruppo di porte esterne ONTAP Select*

image:DDN_09.jpg["Parte 1: Configurazioni dei gruppi di porte esterne ONTAP Select"]

*Parte 2: Configurazioni del gruppo di porte esterne ONTAP Select*

image:DDN_10.jpg["Parte 2: Configurazioni del gruppo di porte esterne ONTAP Select"]

Per la leggibilità, le attività sono le seguenti:

[cols="2*"]
|===
| ONTAP-esterno | ONTAP-External2 


| Adattatori attivi: Vmnic5 adattatori di standby: Vmnic7, vmnic4, vmnic6 | Adattatori attivi: Vmnic7 adattatori di standby: Vmnic5, vmnic6, vmnic4 
|===
Le seguenti figure mostrano le configurazioni dei gruppi di porte di rete interni (ONTAP-Internal e ONTAP-Internal2). Si noti che gli adattatori attivi provengono da schede di rete diverse. In questa configurazione, vmnic 4 e vmnic 5 sono porte doppie sullo stesso ASIC fisico, mentre vmnic 6 e vmnic 7 sono analogamente porte doppie su un ASIC separato. L'ordine degli adattatori di standby fornisce un failover gerarchico con le ultime porte della rete esterna. L'ordine delle porte esterne nell'elenco di standby viene similmente scambiato tra i due gruppi di porte interne.

*Parte 1: Configurazioni del gruppo di porte interne ONTAP Select*

image:DDN_11.jpg["Parte 1: Configurazioni dei gruppi di porte interne ONTAP Select"]

*Parte 2: Gruppi di porte interne ONTAP Select*

image:DDN_12.jpg["Parte 2: Gruppi di porte interne ONTAP Select"]

Per la leggibilità, le attività sono le seguenti:

[cols="2*"]
|===
| ONTAP-interno | ONTAP-Internal2 


| Adattatori attivi: Vmnic4 adattatori di standby: Vmnic6, vmnic5, vmnic7 | Adattatori attivi: Vmnic6 adattatori di standby: Vmnic4, vmnic7, vmnic5 
|===


== VSwitch standard o distribuito e due porte fisiche per nodo

Quando si utilizzano due schede di rete ad alta velocità (25/40 Gb), la configurazione del gruppo di porte consigliata è concettualmente molto simile alla configurazione con quattro adattatori da 10 Gb. È opportuno utilizzare quattro gruppi di porte anche quando si utilizzano solo due adattatori fisici. Le assegnazioni dei gruppi di porte sono le seguenti:

[cols="5*"]
|===
| Gruppo di porte | Esterno 1 (e0a,e0b) | Interno 1 (e0c,e0e) | Interno 2 (e0d,e0f) | Esterno 2 (e0g) 


| Attivo | vmnic0 | vmnic0 | vmnic1 | vmnic1 


| Standby | vmnic1 | vmnic1 | vmnic0 | vmnic0 
|===
*VSwitch con due porte fisiche ad alta velocità (25 GB) per nodo*

image:DDN_17.jpg["VSwitch con due porte fisiche ad alta velocità (25 GB) per nodo"]

Quando si utilizzano due porte fisiche (10 GB o meno), ciascun gruppo di porte deve disporre di un adattatore attivo e di un adattatore di standby configurati uno di fronte all'altro. La rete interna è presente solo per i cluster ONTAP Select a più nodi. Per i cluster a nodo singolo, entrambi gli adattatori possono essere configurati come attivi nel gruppo di porte esterne.

L'esempio seguente mostra la configurazione di un vSwitch e dei due gruppi di porte responsabili della gestione dei servizi di comunicazione interna ed esterna per un cluster ONTAP Select multinodo. In caso di interruzione della rete, la rete esterna può utilizzare la VMNIC della rete interna, poiché le VMNIC della rete interna fanno parte di questo gruppo di porte e sono configurate in modalità standby. Per la rete esterna avviene il contrario. L'alternanza delle VMNIC attive e di standby tra i due gruppi di porte è fondamentale per il corretto failover delle VM ONTAP Select durante le interruzioni di rete.

*VSwitch con due porte fisiche (10 GB o meno) per nodo*

image:DDN_13.jpg["VSwitch con due porte fisiche per nodo"]



== VSwitch distribuito con LACP

Quando si utilizzano vSwitch distribuiti nella configurazione, è possibile utilizzare LACP (anche se non si tratta di una procedura consigliata) per semplificare la configurazione di rete. L'unica configurazione LACP supportata richiede che tutti i VMNIC si trovino in un singolo LAG. Lo switch fisico uplink deve supportare una dimensione MTU compresa tra 7,500 e 9,000 su tutte le porte del canale. Le reti ONTAP Select interne ed esterne devono essere isolate a livello di gruppo di porte. La rete interna deve utilizzare una VLAN non instradabile (isolata). La rete esterna può utilizzare VST, EST o VGT.

Gli esempi seguenti mostrano la configurazione di vSwitch distribuito utilizzando LACP.

*LAG properties when using LACP*

image:DDN_14.jpg["Proprietà LAG quando si utilizza LACP"]

*Configurazioni di gruppi di porte esterne che utilizzano un vSwitch distribuito con LACP attivato*

image:DDN_15.jpg["Configurazioni di gruppi di porte esterne che utilizzano un vSwitch distribuito con LACP attivato"]

*Configurazioni di gruppi di porte interne che utilizzano un vSwitch distribuito con LACP attivato*

image:DDN_16.jpg["Configurazioni di gruppi di porte interne che utilizzano un vSwitch distribuito con LACP attivato"]


NOTE: LACP richiede di configurare le porte dello switch upstream come un canale porta. Prima di abilitare questa configurazione sul vSwitch distribuito, assicurarsi che un canale porta abilitato per LACP sia configurato correttamente.
